"use strict";function parseLimit(e){if(!e)return Number.MAX_VALUE;if("number"==typeof e)return 0<e?e:Number.MAX_VALUE;if(e=e.toString().toLowerCase(),!(e=/^(\d+)(k|m)?$/g.exec(e)))return Number.MAX_VALUE;var t=parseInt(e[1],10);return"k"==e[2]?t*=1024:"m"==e[2]?t*=1048576:"g"==e[2]&&(t*=1073741824),t}function formatSize(e){var t=1024,i="";return t<e&&(e/=t,i=" кб"),t<e&&(e/=t,i=" мб"),(e=(e=e.toFixed(2)).replace(/0+$/gi,"").replace(/\.$/gi,""))+i}var totalSize=0;function bindAttachment(t,i,a){t.find(".delete_file_btn").click(function(e){e.preventDefault(),e.stopPropagation(),totalSize-=a,i.remove(),t.remove(),changeSliderHeight("decrease",30)})}function bindFileInput(e){(e=$(e)).change(function(){var e=$(this),t=$("label[for="+e.attr("id")+"]");if(t.length){var i,a,r,n,l=$('<div class="attachment" />'),c=[],o=0;if($(this.files).each(function(e,t){c.push(t.name),o+=t.size,$('<div class="attachment__item" />').text(t.name+" ("+formatSize(t.size)+")").appendTo(l),$('<a href="#" class="delete_file_btn" />').appendTo(l)}),i="increase",a=30,r=document.querySelector(".slick-list"),n=Number.parseInt(r.style.height),r.style.height="increase"===i?n+a+"px":n-a+"px",c.length){var d=parseLimit(e.attr("data-maxsize"));if(d<totalSize+o)return alert("Ошибка","Размер выбранных файлов "+formatSize(totalSize+o)+" превышает указанный лимит в "+formatSize(d)),e.val(""),void setTimeout(function(){e.change()},1);t.after(l);var f=e.clone();f.val(""),t.after(f),bindFileInput(f),e.removeAttr("id");var m=e.attr("data-id");e.attr("name","doc_"+m),totalSize+=o,bindAttachment(l,e,o)}else t.empty()}})}$(function(){bindFileInput(".fileinput")}),$(function(){$(".modaldelfileclose").click(function(e){e.preventDefault();var t=e.target.parentNode.parentNode;t&&t.classList.add("hidden")}),$("[data-target-modal-file^='confirm_']").click(function(e){e.preventDefault();var t=document.getElementById(e.target.getAttribute("data-target-modal-file")||"");t&&t.classList.remove("hidden")}),$("[id^='delete_cancel_']").click(function(){var e=$(this).attr("id").replace("delete_cancel_","");$("input#"+e).prop("checked",!1),$(".modaldelfileclose").trigger("click")}),$("[id^='modal_accept_del_']").click(function(){var e=$(this).attr("id").replace("modal_accept_del_","");$("input#"+e).prop("checked",!0),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),$(".modaldelfileclose").trigger("click")})});