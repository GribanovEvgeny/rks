"use strict";function changeSliderHeight(e,t){var i=document.querySelector(".slick-list"),a=Number.parseInt(i.style.height);return i.style.height="increase"===e?a+t+"px":a-t+"px"}function parseLimit(e){if(!e)return Number.MAX_VALUE;if("number"==typeof e)return 0<e?e:Number.MAX_VALUE;if(e=e.toString().toLowerCase(),!(e=/^(\d+)(k|m)?$/g.exec(e)))return Number.MAX_VALUE;var t=parseInt(e[1],10);return"k"==e[2]?t*=1024:"m"==e[2]?t*=1048576:"g"==e[2]&&(t*=1073741824),t}function formatSize(e){var t=1024,i="";return t<e&&(e/=t,i=" кб"),t<e&&(e/=t,i=" мб"),(e=(e=e.toFixed(2)).replace(/0+$/gi,"").replace(/\.$/gi,""))+i}var totalSize=0;function bindAttachment(t,i,a){t.find(".delete_file_btn").click(function(e){e.preventDefault(),e.stopPropagation(),totalSize-=a,i.remove(),t.remove(),changeSliderHeight("decrease",37)})}function bindFileInput(e){(e=$(e)).change(function(){var e=$(this),t=$("label[for="+e.attr("id")+"]");if(t.length){var i=$('<div class="attachment" />'),a=[],r=0;if($(this.files).each(function(e,t){a.push(t.name),r+=t.size,$('<div class="attachment__item" />').text(t.name+" ("+formatSize(t.size)+")").appendTo(i),$('<a href="#" class="delete_file_btn" />').appendTo(i),changeSliderHeight("increase",37)}),a.length){var n=parseLimit(e.attr("data-maxsize"));if(n<totalSize+r)return alert("Ошибка","Размер выбранных файлов "+formatSize(totalSize+r)+" превышает указанный лимит в "+formatSize(n)),e.val(""),void setTimeout(function(){e.change()},1);t.after(i);var c=e.clone();c.val(""),t.after(c),bindFileInput(c),e.removeAttr("id");var l=e.attr("data-id");e.attr("name","doc_"+l),totalSize+=r,bindAttachment(i,e,r)}else t.empty()}})}$(function(){bindFileInput(".fileinput")}),$(function(){$(".modaldelfileclose").click(function(e){e.preventDefault();var t=e.target.parentNode.parentNode;t&&t.classList.add("hidden")}),$("[data-target-modal-file^='confirm_']").click(function(e){e.preventDefault();var t=document.getElementById(e.target.getAttribute("data-target-modal-file")||"");t&&t.classList.remove("hidden")}),$("[id^='delete_cancel_']").click(function(){var e=$(this).attr("id").replace("delete_cancel_","");$("input#"+e).prop("checked",!1),$(".modaldelfileclose").trigger("click")}),$("[id^='modal_accept_del_']").click(function(){var e=$(this).attr("id").replace("modal_accept_del_","");$("input#"+e).prop("checked",!0),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),$(".modaldelfileclose").trigger("click"),changeSliderHeight("decrease",37)}),$("[id^='attachment__decldel_']").click(function(){var e=$(this).attr("id").replace("attachment__decldel_","");$("input#"+e).prop("checked",!1),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),changeSliderHeight("decrease",37)})});