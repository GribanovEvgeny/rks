"use strict";var _lk_send_request=require("./lk_send_request.js");function parseLimit(e){if(!e)return Number.MAX_VALUE;if("number"==typeof e)return 0<e?e:Number.MAX_VALUE;if(e=e.toString().toLowerCase(),!(e=/^(\d+)(k|m)?$/g.exec(e)))return Number.MAX_VALUE;var t=parseInt(e[1],10);return"k"==e[2]?t*=1024:"m"==e[2]?t*=1048576:"g"==e[2]&&(t*=1073741824),t}function formatSize(e){var t=1024,a="";return t<e&&(e/=t,a=" кб"),t<e&&(e/=t,a=" мб"),(e=(e=e.toFixed(2)).replace(/0+$/gi,"").replace(/\.$/gi,""))+a}var totalSize=0;function bindAttachment(t,a,i){t.find(".delete_file_btn").click(function(e){e.preventDefault(),e.stopPropagation(),totalSize-=i,a.remove(),t.remove(),(0,_lk_send_request.changeSliderHeight)("decrease",37)})}function bindFileInput(e){(e=$(e)).change(function(){var e=$(this),t=$("label[for="+e.attr("id")+"]");if(t.length){var a=$('<div class="attachment" />'),i=[],n=0;if($(this.files).each(function(e,t){i.push(t.name),n+=t.size,$('<div class="attachment__item" />').text(t.name+" ("+formatSize(t.size)+")").appendTo(a),$('<a href="#" class="delete_file_btn" />').appendTo(a),(0,_lk_send_request.changeSliderHeight)("increase",37)}),i.length){var r=parseLimit(e.attr("data-maxsize"));if(r<totalSize+n)return alert("Ошибка","Размер выбранных файлов "+formatSize(totalSize+n)+" превышает указанный лимит в "+formatSize(r)),e.val(""),void setTimeout(function(){e.change()},1);t.after(a);var c=e.clone();c.val(""),t.after(c),bindFileInput(c),e.removeAttr("id");var d=e.attr("data-id");e.attr("name","doc_"+d),totalSize+=n,bindAttachment(a,e,n)}else t.empty()}})}function docblocksHide(e,i){var n=$("input[name="+i+"]:checked").val();e.each(function(){var e=$(this),t=e.val(),a=e.parent().parent();null==n||0!==t.length&&-1===t.indexOf(n)?a.addClass(i+"_hide"):a.removeClass(i+"_hide"),a.hasClass("personbasis_hide")||a.hasClass("owner_or_tenant_hide")||a.hasClass("connectobjkind_hide")?(a.addClass("hidden"),a.css("display","none")):a.hasClass("personbasis_hide")||a.hasClass("owner_or_tenant_hide")||a.hasClass("connectobjkind_hide")||(a.removeClass("hidden"),a.css("display","flex"))})}function initCheckRadios(e){var t=$('[name^="doc_'+e+'_"]');docblocksHide(t,e);for(var a=document.querySelectorAll("input[name="+e+"]"),i=0;i<a.length;i++){a[i].parentNode.addEventListener("click",function(){return docblocksHide(t,e)})}}$(function(){bindFileInput(".fileinput")}),$(function(){$(".modaldelfileclose").click(function(e){e.preventDefault();var t=e.target.parentNode.parentNode;t&&t.classList.add("hidden")}),$("[data-target-modal-file^='confirm_']").click(function(e){e.preventDefault();var t=document.getElementById(e.target.getAttribute("data-target-modal-file")||"");t&&t.classList.remove("hidden")}),$("[id^='delete_cancel_']").click(function(){var e=$(this).attr("id").replace("delete_cancel_","");$("input#"+e).prop("checked",!1),$(".modaldelfileclose").trigger("click")}),$("[id^='modal_accept_del_']").click(function(){var e=$(this).attr("id").replace("modal_accept_del_","");$("input#"+e).prop("checked",!0),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),$(".modaldelfileclose").trigger("click"),(0,_lk_send_request.changeSliderHeight)("decrease",37)}),$("[id^='attachment__decldel_']").click(function(){var e=$(this).attr("id").replace("attachment__decldel_","");$("input#"+e).prop("checked",!1),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),(0,_lk_send_request.changeSliderHeight)("decrease",35)})}),document.querySelector(".personbasis")&&initCheckRadios("personbasis"),document.querySelector(".owner_or_tenant")&&initCheckRadios("owner_or_tenant"),document.querySelector(".connectobjkind")&&initCheckRadios("connectobjkind");