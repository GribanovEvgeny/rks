"use strict";function parseLimit(e){if(!e)return Number.MAX_VALUE;if("number"==typeof e)return 0<e?e:Number.MAX_VALUE;if(e=e.toString().toLowerCase(),!(e=/^(\d+)(k|m)?$/g.exec(e)))return Number.MAX_VALUE;var t=parseInt(e[1],10);return"k"==e[2]?t*=1024:"m"==e[2]?t*=1048576:"g"==e[2]&&(t*=1073741824),t}function formatSize(e){var t=1024,a="";return t<e&&(e/=t,a=" кб"),t<e&&(e/=t,a=" мб"),(e=(e=e.toFixed(2)).replace(/0+$/gi,"").replace(/\.$/gi,""))+a}var totalSize=0;function bindAttachment(t,a,i){t.find(".delete_file_btn").click(function(e){e.preventDefault(),e.stopPropagation(),totalSize-=i,a.remove(),t.remove()})}function bindFileInput(e){(e=$(e)).change(function(){var e=$(this),t=$("label[for="+e.attr("id")+"]");if(t.length){var a=$('<div class="attachment" />'),i=[],n=0;if($(this.files).each(function(e,t){i.push(t.name),n+=t.size,$('<div class="attachment__item" />').text(t.name+" ("+formatSize(t.size)+")").appendTo(a),$('<a href="#" class="delete_file_btn" />').appendTo(a)}),i.length){var r=parseLimit(e.attr("data-maxsize"));if(r<totalSize+n)return alert("Ошибка","Размер выбранных файлов "+formatSize(totalSize+n)+" превышает указанный лимит в "+formatSize(r)),e.val(""),void setTimeout(function(){e.change()},1);t.after(a);var l=e.clone();l.val(""),t.after(l),bindFileInput(l),e.removeAttr("id");var c=e.attr("data-id");e.attr("name","doc_"+c),totalSize+=n,bindAttachment(a,e,n)}else t.empty()}})}$(function(){bindFileInput(".fileinput")}),$(function(){$(".modaldelfileclose").click(function(e){e.preventDefault();var t=e.target.parentNode.parentNode;t&&t.classList.add("hidden")}),$("[data-target-modal-file^='confirm_']").click(function(e){e.preventDefault();var t=document.getElementById(e.target.getAttribute("data-target-modal-file")||"");t&&t.classList.remove("hidden")}),$("[id^='delete_cancel_']").click(function(){var e=$(this).attr("id").replace("delete_cancel_","");$("input#"+e).prop("checked",!1),$(".modaldelfileclose").trigger("click")}),$("[id^='modal_accept_del_']").click(function(){var e=$(this).attr("id").replace("modal_accept_del_","");$("input#"+e).prop("checked",!0),$("label[for='"+e+"']").hide(),$(".attachment__item_"+e).remove(),$(".modaldelfileclose").trigger("click")})});